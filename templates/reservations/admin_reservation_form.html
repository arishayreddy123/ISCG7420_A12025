{% extends "base.html" %}
{% load static %}

{% block title %}
  <!-- page title: edit vs new -->
  {% if editing %}Edit Reservation{% else %}New Reservation{% endif %}
{% endblock %}

{% block content %}
  <!-- heading shows edit or create -->
  <h1>
    {% if editing %}
      Editing Reservation #{{ editing.id }}
    {% else %}
      Create New Reservation
    {% endif %}
  </h1>

  <!-- reservation form -->
  <form method="post">
    {% csrf_token %}

    <!-- room selector (hidden or read‑only) -->
    <div class="mb-3">
      {{ form.room.label_tag }}<br>
      {{ form.room }}
    </div>

    <!-- user selector -->
    <div class="mb-3">
      {{ form.user.label_tag }}<br>
      {{ form.user }}
    </div>

    <!-- time slot dropdown -->
    <label>Time slot on {{ sel_date|date:"F j, Y" }}:</label>
    <select name="time_slot">
      {% for slot in slots %}
        {% if slot.free %}
          <!-- show free slot -->
          <option value="{{ slot.start|date:'c' }}|{{ slot.end|date:'c' }}">
            {{ slot.start|time:"H:i" }}–{{ slot.end|time:"H:i" }}
          </option>
        {% elif editing and slot.start == editing.start_time %}
          <!-- keep current slot selected -->
          <option value="{{ slot.start|date:'c' }}|{{ slot.end|date:'c' }}" selected>
            {{ slot.start|time:"H:i" }}–{{ slot.end|time:"H:i" }}
          </option>
        {% endif %}
      {% endfor %}
    </select>

    <!-- action buttons -->
    <div class="actions" style="margin-top:1rem;">
      <button type="submit" class="btn btn-primary">
        {% if editing %}Save Changes{% else %}Create Reservation{% endif %}
      </button>
      <!-- cancel link -->
      <a class="btn btn-secondary" href="{% url 'reservations:admin_reservation_list' %}">Cancel</a>
    </div>
  </form>
{% endblock %}
